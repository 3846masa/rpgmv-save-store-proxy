'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _express = require('express');

var _passport = require('passport');

var _passport2 = _interopRequireDefault(_passport);

var _passportHttp = require('passport-http');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const USERNAME = process.env.USERNAME || 'user';
const PASSWORD = process.env.PASSWORD || 'password';

_passport2.default.use(new _passportHttp.DigestStrategy({ qop: '認証 Authenticate' }, authenticate, (params, done) => done(null, true)));

function authenticate(username, done) {
  if (username !== USERNAME) done(null, false);else done(null, username, PASSWORD);
}

let router = (0, _express.Router)();
router.use(_passport2.default.initialize());
router.use(_passport2.default.session());
router.use((req, res, next) => {
  if (req.url.match(/^\/api\//) || req.url.match(/\/$/) || req.url.match(/\/index\..*?$/)) {
    _passport2.default.authenticate('digest', { session: false })(req, res, next);
  } else {
    next();
  }
});

exports.default = router;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXNzcG9ydC1yb3V0ZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUlBLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxJQUFJLE1BQU0sQ0FBQztBQUNoRCxNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsSUFBSSxVQUFVLENBQUM7O0FBRXBELG1CQUFTLEdBQUcsQ0FBQyxrQkFMSixjQUFjLENBTXJCLEVBQUUsR0FBRyxFQUFFLGlCQUFpQixFQUFFLEVBQzFCLFlBQVksRUFDWixDQUFDLE1BQU0sRUFBRSxJQUFJLEtBQUssSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FDbkMsQ0FBQyxDQUFDOztBQUVILFNBQVMsWUFBWSxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUU7QUFDcEMsTUFBSSxRQUFRLEtBQUssUUFBUSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUMsS0FDeEMsSUFBSSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7Q0FDckM7O0FBRUQsSUFBSSxNQUFNLEdBQUcsYUFsQkosTUFBTSxHQWtCTSxDQUFDO0FBQ3RCLE1BQU0sQ0FBQyxHQUFHLENBQUMsbUJBQVMsVUFBVSxFQUFFLENBQUMsQ0FBQztBQUNsQyxNQUFNLENBQUMsR0FBRyxDQUFDLG1CQUFTLE9BQU8sRUFBRSxDQUFDLENBQUM7QUFDL0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxLQUFLO0FBQzdCLE1BQ0UsR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLElBQ3pCLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUNwQixHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsRUFDOUI7QUFDQSx1QkFBUyxZQUFZLENBQUMsUUFBUSxFQUFFLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztHQUNyRSxNQUFNO0FBQ0wsUUFBSSxFQUFFLENBQUM7R0FDUjtDQUNGLENBQUMsQ0FBQzs7a0JBRVksTUFBTSIsImZpbGUiOiJwYXNzcG9ydC1yb3V0ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBwYXNzcG9ydCBmcm9tICdwYXNzcG9ydCc7XG5pbXBvcnQgeyBEaWdlc3RTdHJhdGVneSB9IGZyb20gJ3Bhc3Nwb3J0LWh0dHAnO1xuXG5jb25zdCBVU0VSTkFNRSA9IHByb2Nlc3MuZW52LlVTRVJOQU1FIHx8ICd1c2VyJztcbmNvbnN0IFBBU1NXT1JEID0gcHJvY2Vzcy5lbnYuUEFTU1dPUkQgfHwgJ3Bhc3N3b3JkJztcblxucGFzc3BvcnQudXNlKG5ldyBEaWdlc3RTdHJhdGVneShcbiAgeyBxb3A6ICfoqo3oqLwgQXV0aGVudGljYXRlJyB9LFxuICBhdXRoZW50aWNhdGUsXG4gIChwYXJhbXMsIGRvbmUpID0+IGRvbmUobnVsbCwgdHJ1ZSlcbikpO1xuXG5mdW5jdGlvbiBhdXRoZW50aWNhdGUodXNlcm5hbWUsIGRvbmUpIHtcbiAgaWYgKHVzZXJuYW1lICE9PSBVU0VSTkFNRSkgZG9uZShudWxsLCBmYWxzZSk7XG4gIGVsc2UgZG9uZShudWxsLCB1c2VybmFtZSwgUEFTU1dPUkQpO1xufVxuXG5sZXQgcm91dGVyID0gUm91dGVyKCk7XG5yb3V0ZXIudXNlKHBhc3Nwb3J0LmluaXRpYWxpemUoKSk7XG5yb3V0ZXIudXNlKHBhc3Nwb3J0LnNlc3Npb24oKSk7XG5yb3V0ZXIudXNlKChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICBpZiAoXG4gICAgcmVxLnVybC5tYXRjaCgvXlxcL2FwaVxcLy8pIHx8XG4gICAgcmVxLnVybC5tYXRjaCgvXFwvJC8pIHx8XG4gICAgcmVxLnVybC5tYXRjaCgvXFwvaW5kZXhcXC4uKj8kLylcbiAgKSB7XG4gICAgcGFzc3BvcnQuYXV0aGVudGljYXRlKCdkaWdlc3QnLCB7IHNlc3Npb246IGZhbHNlIH0pKHJlcSwgcmVzLCBuZXh0KTtcbiAgfSBlbHNlIHtcbiAgICBuZXh0KCk7XG4gIH1cbn0pO1xuXG5leHBvcnQgZGVmYXVsdCByb3V0ZXI7XG4iXX0=